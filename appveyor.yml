image:
  - Visual Studio 2017

platform:
  - x86

configuration:
  - Debug
  - Release

before_build:
  - cmd: C:\msys64\usr\bin\bash.exe -l -c "pacman -S --needed --noconfirm --noprogressbar yasm tar make"
  - ps: Start-FileDownload 'https://www.sfml-dev.org/files/SFML-2.4.2-windows-vc14-32-bit.zip'
  - ps: Expand-Archive SFML-2.4.2-windows-vc14-32-bit.zip -DestinationPath C:\projects\sfemovie\tmp
  - cmd: python C:\projects\sfemovie\ci\run.py --sources C:\projects\sfemovie --decoders Free --config %CONFIGURATION% --sfml_root C:\projects\sfemovie\tmp\SFML-2.4.2

after_build:
  - cmd: Pushd C:\projects\sfemovie\ci-output
  - cmd: cpack -C %CONFIGURATION% --config CPackConfig.cmake
  - cmd: Popd

artifacts:
- path: ci-output\sfeMovie*.zip
  name: sfeMovieLibrary

deploy:
- provider: GitHub
  name: "AppVeyor release"
  description: "sfeMovie build for Windows"
  auth_token:
    secure: NWsZkjMy0WQ8bc0HTmEEgLHfWUW3IMkrLkbcG9+6STpDliEIqVY3Q5jZ8xVuI9lovskHE1sbs0nlJRIRFuTUjB1s9UW6IasbSV115ah111ljBFlA3Gm0cSYXM+8DGZJGb7QjrEko75tfoeBHnm/+ps7/hp/4EwhLbkeDh+P8/hc=
  artifact: sfeMovieLibrary
  on:
    branch:
    - master
    - ci/AppVeyor

skip_tags: true
